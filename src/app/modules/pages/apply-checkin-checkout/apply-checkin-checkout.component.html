<main id="main" class="main">
    <div class="pagetitle">
        <div>
            <strong class="font-size-16">Danh s√°ch ƒë∆°n</strong>
            <p-breadcrumb [model]="items"> </p-breadcrumb>
        </div>

        <div
            class="btn-add-wrapper">
            <button
                pButton
                pRipple
                label="G·ª≠i ƒë∆°n"
                icon="pi pi-plus"
                style="height: 40px; width: 130px; border-radius: 10px"
                (click)="showDialog()"
            ></button>
        </div>
    </div>
    <div class="toast-container">
        <p-messages
            [(value)]="messages"
            [enableService]="false"
            [closable]="false"
        ></p-messages>
    </div>
    <!-- End Page Title -->
    <section class="section k-list-table">
        <div class="row">
            <div class="col-lg-12">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 mt-3">
                            <p-autoComplete
                                [style]="{ height: '43px', width: '100%' }"
                                [(ngModel)]="selectedEmployee"
                                [suggestions]="filteredEmployees"
                                (completeMethod)="searchEmployee($event)"
                                [field]="'displayName'"
                                [forceSelection]="true"
                                [showClear]="true"
                                placeholder="T√¨m ki·∫øm nh√¢n vi√™n">
                            </p-autoComplete>
                        </div>

                        <!-- <div class="col-lg-3 mt-3">
                            <p-dropdown
                                [(ngModel)]="selectedContractStatus"
                                [options]="contractOption"
                                optionLabel="name"
                                [showClear]="true"
                                placeholder="T·∫•t c·∫£ h·ª£p ƒë·ªìng"

                                [style]="{ height: '43px', width: '100%' }"
                            ></p-dropdown>
                        </div>
                        <div class="col-lg-3 mt-3">
                            <p-treeSelect
                                [options]="treeData"
                                [(ngModel)]="selectedNode"
                                [placeholder]="'T·∫•t c·∫£ ƒë∆°n v·ªã'"
                                [style]="{ width: '100%' }"
                            ></p-treeSelect>
                        </div> -->
                        <div class="col-lg-1 mt-3">
                            <button
                                style="height: 43px"
                                pButton
                                pRipple
                                label="L·ªçc"
                                class="buttonfilter"
                                (click)="getPaging()"
                            ></button>
                        </div>
                        <div class="col-lg-1 mt-3">
                            <div style="display: flex">
                                <p-button
                                    label=""
                                    [outlined]="true"
                                    severity="secondary"
                                    icon="pi pi-filter"
                                ></p-button>

                                <p-button
                                    style="margin-left: 10px"
                                    label=""
                                    [outlined]="true"
                                    severity="secondary"
                                    icon="pi pi-file-export"
                                ></p-button>

                                <p-button
                                    style="margin-left: 10px"
                                    label=""
                                    [outlined]="true"
                                    severity="secondary"
                                    icon="pi pi-spin pi-cog"
                                ></p-button>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <p-table
                            [value]="checkInCheckOuts"
                            [paginator]="true"
                            [rows]="pageSize"
                            [totalRecords]="totalRecords"
                            [paginator]="false"
                            (onPage)="onPageChange($event)"
                            styleClass="p-datatable-striped"
                        >
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 1%">
                                        <p-checkbox
                                            [binary]="true"
                                            inputId="binary"
                                        ></p-checkbox>
                                    </th>
                                    <th style="width: 6%">M√£ nh√¢n vi√™n</th>
                                    <th style="width: 6%">H·ªç v√† T√™n NLƒê</th>
                                    <th style="width: 5%">Th·ªùi gian xin ch·∫•m v√†o</th>
                                    <th style="width: 6%">Th·ªùi gian xin ch·∫•m ra</th>
                                    <th style="width: 5%">L√Ω do</th>
                                    <th style="width: 4%">Ng√†y g·ª≠i</th>
                                    <th style="width: 4%">Ng∆∞·ªùi duy·ªát</th>
                                    <th style="width: 4%">Tr·∫°ng th√°i</th>
                                    <th style="width: 2%">Thao t√°c</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-contract>
                                <tr>
                                    <td>
                                        <p-checkbox
                                            [binary]="true"
                                            inputId="binary"
                                        ></p-checkbox>
                                    </td>
                                    <td>{{ contract.employee.employeeCode }}</td>
                                    <td>{{ contract.employee.lastName }} {{ contract.employee.firstName }}</td>
                                    <td>{{ contract.timeCheckIn }}</td>
                                    <td>{{ contract.timeCheckOut }}</td>
                                    <td>{{ contract.reason }}</td>
                                    <td>
                                        {{
                                            contract.date | date : "dd/MM/yyyy"
                                        }}
                                    </td>
                                    <td>{{ contract.approver.lastName }} {{ contract.approver.firstName }}</td>
                                        <div style="margin: 10px 20px" [ngSwitch]="contract.checkInCheckOutStatus">
                                            <span *ngSwitchCase="0" class="status-pending">Ch·ªù duy·ªát</span>
                                            <span *ngSwitchCase="1" class="status-approved">ƒê√£ duy·ªát</span>
                                            <span *ngSwitchCase="2" class="status-rejected">T·ª´ ch·ªëi</span>
                                            <span *ngSwitchDefault>Kh√¥ng x√°c ƒë·ªãnh</span>
                                        </div>
                                    <td style="text-align: center">
                                        <i
                                            class="pi pi-ellipsis-v"
                                            (click)="menu.toggle($event)"
                                        ></i>
                                        <p-overlayPanel #menu>
                                            <div class="menu-items">
                                                <button *ngIf="user.id == contract.employee?.id" class="menu-btn" (click)="showDialogEdit(contract.id)">
                                                    <i class="pi pi-pencil"> S·ª≠a</i>
                                                </button>
                                                <button *ngIf="user.id !== contract.employee?.id" class="menu-btn" (click)="showDialogEdit(contract.id)">
                                                    <i class="pi pi-eye"> Xem</i>
                                                </button>
                                                <button class="menu-btn" (click)="updateStatus(contract, 1)" *ngIf="contract.checkInCheckOutStatus === 0">
                                                    <i class="pi pi-check"></i> X√°c nh·∫≠n
                                                </button>
                                                <button class="menu-btn" (click)="updateStatus(contract, 2)" *ngIf="contract.checkInCheckOutStatus === 0">
                                                    <i class="pi pi-times"></i> T·ª´ ch·ªëi
                                                </button>
                                            </div>
                                        </p-overlayPanel>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>

                        <div
                            *ngIf="totalRecords === 0"
                            style="text-align: center; margin-top: 20px"
                        >
                            <strong style="text-align: center; width: 100%"
                                >Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p</strong
                            >
                        </div>

                        <div class="paging-bot dg-fix">
                            <div class="paging-info">
                                <div [innerHTML]="currentPageReport"></div>
                            </div>
                            <p-paginator
                                [rows]="this.pageSize"
                                (onPageChange)="onPageChange($event)"
                                [totalRecords]="
                                    totalRecords > 0 ? totalRecords : 1
                                "
                                [rowsPerPageOptions]="[10, 20, 30]"
                                [first]="(this.pageIndex - 1) * this.pageSize"
                            ></p-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <p-dialog header="ƒê∆°n checkin/checkout" [(visible)]="displayDialog" [modal]="true" [style]="{width: '50vw'}" (onHide)="resetForm()">
            <form [formGroup]="checkInForm">
                <div class="form-container">
                    <div class="checkbox-group">
                        <p-checkbox name="checkInOut" value="checkIn"
                            [binary]="true"
                            [ngModel]="checkInForm.value.checkType?.includes('checkIn')"
                            (onChange)="onCheckTypeChange($event, 'checkIn')"
                            label="Ch·∫•m v√†o"
                            [ngModelOptions]="{standalone: true}">
                        </p-checkbox>

                        <p-checkbox name="checkInOut" value="checkOut"
                            [binary]="true"
                            [ngModel]="checkInForm.value.checkType?.includes('checkOut')"
                            (onChange)="onCheckTypeChange($event, 'checkOut')"
                            label="Ch·∫•m ra"
                            [ngModelOptions]="{standalone: true}">
                        </p-checkbox>
                    </div>

                    <!-- Ng√†y - Gi·ªù ch·∫•m v√†o -->
                    <div class="field-group">
                        <div class="field">
                            <label>Ng√†y <span class="red-asterisk">*</span></label>
                            <p-calendar
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [showIcon]="true"
                                dateFormat="dd/mm/yy"
                                formControlName="date"
                                placeholder="Ch·ªçn ng√†y">
                            </p-calendar>
                        </div>
                        <div class="field" *ngIf="showCheckIn">
                            <label>Gi·ªù ch·∫•m v√†o <span class="red-asterisk">*</span></label>
                            <p-calendar
                                formControlName="timeCheckIn"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [iconDisplay]="'input'"
                                [showIcon]="true"
                                [timeOnly]="true"
                                inputId="time">
                                <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
                                    <i class="pi pi-clock pointer-events-none pointer-events-none"  (click)="clickCallBack($event)"></i>
                                </ng-template>
                            </p-calendar>
                        </div>
                        <div class="field" *ngIf="showCheckOut">
                            <label>Gi·ªù ch·∫•m ra</label>
                            <p-calendar
                                formControlName="timeCheckOut"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [iconDisplay]="'input'"
                                [showIcon]="true"
                                [timeOnly]="true"
                                inputId="time">
                                <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
                                    <i class="pi pi-clock pointer-events-none pointer-events-none"  (click)="clickCallBack($event)"></i>
                                </ng-template>
                            </p-calendar>
                        </div>
                    </div>

                    <!-- Ca - L√Ω do -->
                    <div class="field-group">

                        <div class="field">
                            <label>Ca</label>
                            <p-dropdown
                                [options]="shiftWorks"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                optionLabel="name"
                                [showClear]="true"
                                optionValue="id"
                                formControlName="shiftCatalogId"
                                placeholder="Ch·ªçn th√¥ng tin">
                            </p-dropdown>
                        </div>
                        <div class="field">
                            <label>Ng∆∞·ªùi duy·ªát</label>
                            <p-dropdown
                                formControlName="approverId"
                                [options]="employeess"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                optionValue="id"
                                optionLabel="name"
                                [showClear]="true"
                                [filter]="true"
                                [filterBy]="'name,employeeCode'"
                                placeholder="Ch·ªçn th√¥ng tin"
                            ></p-dropdown>
                        </div>
                    </div>

                    <div class="field-group">
                        <!-- Ng∆∞·ªùi duy·ªát -->
                        <div class="field">
                            <label>L√Ω do</label>
                            <textarea pInputTextarea formControlName="reason"></textarea>
                        </div>

                        <!-- M√¥ t·∫£ -->
                        <div class="field">
                            <label>M√¥ t·∫£</label>
                            <div class="description-container">
                                <!-- Thanh c√¥ng c·ª• -->
                                <div class="toolbar">
                                    <!-- <button (click)="formatText('bold')" pTooltip="Bold"><i class="pi pi-bold"></i></button>
                                    <button (click)="formatText('italic')" pTooltip="Italic"><i class="pi pi-italic"></i></button>
                                    <button (click)="formatText('underline')" pTooltip="Underline"><i class="pi pi-face-smile"></i></button>
                                    <button (click)="insertLink()" pTooltip="Insert Link"><i class="pi pi-link"></i></button> -->

                                    <!-- Emoji Button -->
                                    <div class="emoji-container">
                                        <button (click)="toggleEmojiPicker()" pTooltip="Emoji">üòÄ</button>

                                        <!-- Danh s√°ch Emoji -->
                                        <div class="emoji-picker" *ngIf="showEmojiPicker">
                                            <span *ngFor="let emoji of emojiList" (click)="insertEmoji(emoji)">
                                                {{ emoji }}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- √î nh·∫≠p m√¥ t·∫£ -->
                                <textarea formControlName="description" id="descriptionBox" placeholder="Nh·∫≠p m√¥ t·∫£"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Button -->
                    <div class="button-container">
                        <button pButton label="H·ªßy" class="cancel-button" (click)="displayDialog = false"></button>
                        <button type="submit" pButton label="G·ª≠i" class="submit-button" (click)="submitForm()"></button>
                    </div>

                </div>
            </form>
        </p-dialog>

        <p-dialog header="S·ª≠a ƒë∆°n checkin/checkout" [(visible)]="displayDialogEdit" [modal]="true" [style]="{width: '50vw'}" (onHide)="resetFormEdit()">
            <form [formGroup]="checkInUpdateForm">
                <div class="form-container">
                    <div class="checkbox-group">
                        <p-checkbox name="checkInOut" value="checkIn"
                            [binary]="true"
                            [ngModel]="checkInUpdateForm.value.checkType?.includes('checkIn')"
                            (onChange)="onCheckTypeChangeUpdate($event, 'checkIn')"
                            label="Ch·∫•m v√†o"
                            [ngModelOptions]="{standalone: true}">
                        </p-checkbox>

                        <p-checkbox name="checkInOut" value="checkOut"
                            [binary]="true"
                            [ngModel]="checkInUpdateForm.value.checkType?.includes('checkOut')"
                            (onChange)="onCheckTypeChangeUpdate($event, 'checkOut')"
                            label="Ch·∫•m ra"
                            [ngModelOptions]="{standalone: true}">
                        </p-checkbox>
                    </div>

                    <!-- Ng√†y - Gi·ªù ch·∫•m v√†o -->
                    <div class="field-group">
                        <div class="field">
                            <label>Ng√†y <span class="red-asterisk">*</span></label>
                            <p-calendar
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [showIcon]="true"
                                dateFormat="dd/mm/yy"
                                formControlName="date"
                                placeholder="Ch·ªçn ng√†y">
                            </p-calendar>
                        </div>
                        <div class="field" *ngIf="showCheckIn">
                            <label>Gi·ªù ch·∫•m v√†o <span class="red-asterisk">*</span></label>
                            <p-calendar
                                formControlName="timeCheckIn"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [iconDisplay]="'input'"
                                [showIcon]="true"
                                [timeOnly]="true"
                                inputId="time">
                                <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
                                    <i class="pi pi-clock pointer-events-none pointer-events-none"  (click)="clickCallBack($event)"></i>
                                </ng-template>
                            </p-calendar>
                        </div>
                        <div class="field" *ngIf="showCheckOut">
                            <label>Gi·ªù ch·∫•m ra</label>
                            <p-calendar
                                formControlName="timeCheckOut"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                [iconDisplay]="'input'"
                                [showIcon]="true"
                                [timeOnly]="true"
                                inputId="time">
                                <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack">
                                    <i class="pi pi-clock pointer-events-none pointer-events-none"  (click)="clickCallBack($event)"></i>
                                </ng-template>
                            </p-calendar>
                        </div>
                    </div>

                    <!-- Ca - L√Ω do -->
                    <div class="field-group">

                        <div class="field">
                            <label>Ca</label>
                            <p-dropdown
                                [options]="shiftWorks"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                optionLabel="name"
                                [showClear]="true"
                                optionValue="id"
                                formControlName="shiftCatalogId"
                                placeholder="Ch·ªçn th√¥ng tin">
                            </p-dropdown>
                        </div>
                        <div class="field">
                            <label>Ng∆∞·ªùi duy·ªát</label>
                            <p-dropdown
                                formControlName="approverId"
                                [options]="employeess"
                                [style]="{
                                    height: '50px',
                                    width: '100%'
                                }"
                                optionValue="id"
                                optionLabel="name"
                                [showClear]="true"
                                [filter]="true"
                                [filterBy]="'name,employeeCode'"
                                placeholder="Ch·ªçn th√¥ng tin"
                            ></p-dropdown>
                        </div>
                    </div>

                    <div class="field-group">
                        <!-- Ng∆∞·ªùi duy·ªát -->
                        <div class="field">
                            <label>L√Ω do</label>
                            <textarea pInputTextarea formControlName="reason"></textarea>
                        </div>

                        <!-- M√¥ t·∫£ -->
                        <div class="field">
                            <label>M√¥ t·∫£</label>
                            <div class="description-container">
                                <!-- Thanh c√¥ng c·ª• -->
                                <div class="toolbar">
                                    <!-- <button (click)="formatText('bold')" pTooltip="Bold"><i class="pi pi-bold"></i></button>
                                    <button (click)="formatText('italic')" pTooltip="Italic"><i class="pi pi-italic"></i></button>
                                    <button (click)="formatText('underline')" pTooltip="Underline"><i class="pi pi-face-smile"></i></button>
                                    <button (click)="insertLink()" pTooltip="Insert Link"><i class="pi pi-link"></i></button> -->

                                    <!-- Emoji Button -->
                                    <div class="emoji-container">
                                        <button (click)="toggleEmojiPicker()" pTooltip="Emoji">üòÄ</button>

                                        <!-- Danh s√°ch Emoji -->
                                        <div class="emoji-picker" *ngIf="showEmojiPicker">
                                            <span *ngFor="let emoji of emojiList" (click)="insertEmoji(emoji)">
                                                {{ emoji }}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- √î nh·∫≠p m√¥ t·∫£ -->
                                <textarea formControlName="description" id="descriptionBox" placeholder="Nh·∫≠p m√¥ t·∫£"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Button -->
                    <div class="button-container" *ngIf="user.id === selected?.employeeId">
                        <button pButton label="H·ªßy" class="cancel-button" (click)="displayDialog = false"></button>
                        <button type="submit" pButton label="L∆∞u" class="submit-button" (click)="submitUpdateForm()"></button>
                    </div>

                </div>
            </form>
        </p-dialog>
        <!---->
    </section>
</main>
<!-- End #main -->



