<p>
    <button
        pButton
        (click)="createJobVisible = true"
        label="Thêm công việc"
    ></button>
    <button
        pButton
        (click)="createLoopJobVisible = true"
        label="Lặp lại công việc"
    ></button>
</p>

<p-dialog
    header="Thêm tên công việc"
    [(visible)]="createJobVisible"
    [modal]="true"
    [style]="{ width: '80rem' }"
    [closable]="true"
>
    <ng-template pTemplate="header">
        <div class="flex justify-content-between w-full align-items-center">
            <p-dropdown
                [options]="completionOptions"
                [(ngModel)]="selectedCity"
                optionLabel="label"
                placeholder="Select a City"
            />
            <div class="flex gap-3 mr-4">
                <span>
                    <i class="pi pi-comment" style="font-size: 1.5rem"></i>
                </span>
                <span>
                    <i class="pi pi-link" style="font-size: 1.5rem"></i>
                </span>
                <span>
                    <i class="pi pi-tags" style="font-size: 1.5rem"></i>
                </span>
                <span>
                    <i class="pi pi-ellipsis-h" style="font-size: 1.5rem"></i>
                </span>
            </div>
        </div>
    </ng-template>
    <div class="flex gap-6">
        <div class="p-fluid grid formgrid infor-job">
            <div class="d-block px-3">
                <!-- <p (click)="openDialogcheckKhoa()">Show description check</p> -->
                <app-popup-approve></app-popup-approve>
            </div>
            <div class="col-12">
                <div class="flex justify-content-between">
                    <div></div>
                    <div class="box-priority">
                        <button
                            class="priority-button flex justify-content-between"
                            [ngClass]="getPriorityClass()"
                        >
                            <i
                                class="pi"
                                [ngClass]="{
                                    'pi-chevron-up': selectedPriority === 'Cao',
                                    'pi-align-justify':
                                        selectedPriority === 'Trung bình',
                                    'pi-chevron-down':
                                        selectedPriority === 'Thấp'
                                }"
                            ></i>
                            <span>
                                {{ selectedPriority }}
                            </span>
                            <i class="pi pi-chevron-down"></i>
                        </button>

                        <div class="popup-priority">
                            <h5 style="font-size: 14px" class="mb-3">
                                Chọn độ ưu tiên
                            </h5>
                            <button
                                class="priority-option high"
                                (click)="selectPriority('Cao')"
                            >
                                <i class="pi pi-chevron-up"></i> Cao
                            </button>
                            <button
                                class="priority-option medium"
                                (click)="selectPriority('Trung bình')"
                            >
                                <i class="pi pi-align-justify"></i> Trung bình
                            </button>
                            <button
                                class="priority-option low"
                                (click)="selectPriority('Thấp')"
                            >
                                <i class="pi pi-chevron-down"></i> Thấp
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="flex justify-content-between align-items-center col-12 mb-3"
            >
                <!-- <h4 class="m-0">Thêm tên công việc</h4> -->
                <div
                    *ngIf="!isEditing && taskName != ''"
                    (click)="enableEdit(taskName)"
                >
                    <h4 class="m-0">{{ taskName }}</h4>
                </div>

                <div class="w-full mt-2" *ngIf="isEditing || taskName === ''">
                    <input
                        type="text"
                        pInputText
                        spellcheck="false"
                        [style]="{ width: '100%' }"
                        [(ngModel)]="taskName"
                        (blur)="saveTaskName()"
                        (keydown.enter)="saveTaskName()"
                        placeholder="Nhập tên công việc..."
                        autofocus
                    />
                </div>
            </div>
            <!-- Người giao việc -->
            <div class="col-12 mb-3">
                <div class="flex gap-2">
                    <label for="nguoiGiao" class="block font-semibold"
                        >Người giao việc:</label
                    >
                    <div class="flex align-items-center gap-2">
                        <span>Hải Dương</span>
                    </div>
                </div>
            </div>
            <!-- Người thực hiện -->
            <div class="col-12 md:col-6">
                <label for="nguoiThucHien" class="block mb-2 font-semibold"
                    >Người thực hiện:</label
                >
                <div class="flex gap-2">
                    <p-dropdown
                        id="nguoiThucHien"
                        [options]="userOptions"
                        style="width: 100%; display: block"
                        placeholder="Chọn người thực hiện"
                    ></p-dropdown>
                    <div class="avatar-user">
                        <img
                            [src]="
                                'https://tse2.mm.bing.net/th?id=OIP.K2zUmpCpSE0eLQJ2j5fvrQHaEK&pid=Api&P=0&h=180'
                            "
                            alt=""
                        />
                    </div>
                </div>
            </div>

            <!-- Hạn hoàn thành -->
            <div class="col-12 md:col-6">
                <label for="hanHoanThanh" class="block mb-2 font-semibold"
                    >Hạn hoàn thành:</label
                >
                <div class="flex gap-2 align-items-center">
                    <p-calendar
                        [(ngModel)]="date2"
                        [iconDisplay]="'input'"
                        [showIcon]="true"
                        inputId="icondisplay"
                        placeholder="dd/mm/yyyy"
                    />
                    -
                    <p-calendar
                        [(ngModel)]="date2"
                        [iconDisplay]="'input'"
                        [showIcon]="true"
                        inputId="icondisplay"
                        placeholder="dd/mm/yyyy"
                    />
                </div>
            </div>

            <!-- Mô tả -->
            <div class="col-12 mb-3 mt-2">
                <div class="flex gap-2">
                    <span class="">
                        <i class="pi pi-align-center"></i>
                    </span>
                    <label for="moTa" class="block">Nhập mô tả</label>
                </div>
            </div>

            <!-- Checklist -->
            <div class="col-12 mb-3">
                <div class="mb-2">
                    <div *ngFor="let item of checklist">
                        <p-checkbox
                            class="mb-2"
                            [(ngModel)]="item.selected"
                            [label]="item.name"
                            [value]="item.name"
                            name="checkboxGroup"
                        >
                        </p-checkbox>
                    </div>
                </div>
                <div class="" *ngIf="openChecklist">
                    <input
                        type="text"
                        pInputText
                        [style]="{ height: '35px' }"
                        [showClear]="true"
                    />
                </div>
                <div class="flex gap-2 mt-2">
                    <span (click)="toggleChecklist()" class="cursor-pointer">
                        <i class="pi pi-plus-circle"></i>
                    </span>
                    <label
                        for="checklist"
                        class="block cursor-pointer"
                        (click)="toggleChecklist()"
                        >Thêm checklist</label
                    >
                </div>
            </div>

            <!-- Thêm thẻ -->
            <div class="col-12 mb-3">
                <div class="flex gap-2">
                    <span class="">
                        <i class="pi pi-plus-circle"></i>
                    </span>
                    <label for="moTa" class="block">Thêm thẻ</label>
                </div>
            </div>

            <!-- File đính kèm -->
            <div class="col-12">
                <div class="flex gap-2 mb-3">
                    <span>
                        <i class="pi pi-link"></i>
                    </span>
                    <label for="fileDinhKem" class="block">Tệp đính kèm</label>
                </div>
                <div
                    class="border-dashed surface-border flex align-items-center justify-content-center py-6"
                    style="border-radius: 5px"
                >
                    <span class="pi pi-upload mr-2"></span>
                    <span>Thả tệp hoặc tải lên ở đây</span>
                </div>
            </div>

            <!-- Thêm công việc con khoa -->
            <div class="col-12 mb-2 mt-2">
                <!-- list danh sách công việc  -->
                <div class="">
                    <div
                        class="d-flex justify-content-between align-items-center item-job z-5"
                        *ngFor="let job of listjobitem"
                    >
                        <div class="d-flex align-item-center">
                            <p-checkbox
                                [(ngModel)]="checked"
                                [binary]="true"
                                inputId="binary"
                            />
                            <p class="text-job-item">
                                {{ job.name }}
                            </p>
                        </div>
                        <div class="d-flex">
                            <!-- <i
                                class="pi pi-user icon-create-job cursor-pointer mr-2"
                                (click)="toggleDropdown()"
                            ></i>
                            <i
                                class="pi pi-calendar icon-create-job cursor-pointer"
                            ></i> -->
                            <p-multiSelect
                                [options]="testUser"
                                optionLabel="name"
                                placeholder="Chọn nhân viên"
                                [ngStyle]="{
                                    width: '200px',
                                    border: 'none',
                                    marginRight: '10px'
                                }"
                                appendTo="body"
                                [filter]="true"
                                filterPlaceholder="Tìm kiếm nhân viên"
                                auto
                            ></p-multiSelect>

                            <p-calendar
                                dateFormat="dd/mm/yy"
                                selectionMode="range"
                                [placeholder]="'từ ngay → đến ngày'"
                                [style]="{ width: '200px',  }"
                                appendTo="body"
                            >
                            </p-calendar>
                        </div>
                    </div>
                </div>

                <!-- input thêm công việc con -->
                <div class="" *ngIf="openInputCreate">
                    <input
                        type="text"
                        pInputText
                        [style]="{ height: '35px' }"
                    />
                </div>

                <div class="flex gap-2 cursor-pointer mt-3">
                    <span class="" (click)="toggleOpenCreateJob()">
                        <i class="pi pi-plus-circle"></i>
                    </span>
                    <label
                        for="moTa"
                        (click)="toggleOpenCreateJob()"
                        class="block cursor-pointer"
                        >Thêm công việc con</label
                    >
                </div>
            </div>
            <div class="col-12">
                <div class="flex gap-3 align-items-center">
                    <input
                        type="text"
                        pInputText
                        placeholder="Nhập và nhấn Enter để gửi"
                    />
                    <span>
                        <i
                            class="pi pi-paperclip"
                            style="font-size: 1.5rem"
                        ></i>
                    </span>
                    <span>
                        <i class="pi pi-send" style="font-size: 1.5rem"></i>
                    </span>
                </div>
            </div>
        </div>
        <div class="flex flex-column gap-3 text-600" style="width: 500px">
            <!-- Phê duyệt -->
            <div class="flex align-items-center gap-3">
                <!-- (click)="openApproveDialog()" -->
                <i class="pi pi-check text-500"></i>
                <span>Phê duyệt</span>
                <app-popup-approve></app-popup-approve>
            </div>

            <!-- Lặp lại -->
            <div class="flex align-items-center gap-3">
                <i class="pi pi-refresh text-500"></i>
                <span>Lặp lại</span>
            </div>

            <!-- Nhắc việc -->
            <div class="flex align-items-center gap-3">
                <i class="pi pi-bell text-500"></i>
                <span>Nhắc việc</span>
            </div>

            <!-- Người liên quan -->
            <div class="flex align-items-center gap-3">
                <i class="pi pi-user text-500"></i>
                <span>Người liên quan</span>
            </div>

            <!-- Đã tạo bởi -->
            <div class="flex flex-column text-700">
                <div class="flex align-items-center gap-3">
                    <i class="pi pi-plus-circle text-500"></i>
                    <div class="flex flex-column">
                        <span>Đã tạo bởi <strong>Hải Dương</strong></span>
                        <span class="text-500">1/3/2025 08:34</span>
                    </div>
                </div>
            </div>

            <!-- Đã cập nhật tiến độ -->
            <div class="flex flex-column text-700">
                <div class="flex align-items-center gap-3">
                    <div class="flex align-items-center gap-3">
                        <i class="pi pi-pencil text-500"></i>
                        <div class="flex flex-column">
                            <span
                                >Đã cập nhật tiến độ bởi
                                <strong>Hải Dương</strong></span
                            >
                            <span class="text-500">1/3/2025 09:34</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
            <p-button label="Hủy" [outlined]="true" severity="secondary" />
            <p-button label="Lưu" (onClick)="saveJob()"></p-button>
        </div>
    </ng-template>
</p-dialog>

<!-- Lặp lại công việc -->
<p-dialog
    header="Thêm tên công việc"
    [(visible)]="createLoopJobVisible"
    [modal]="true"
    [style]="{ width: '50rem' }"
    [closable]="true"
>
    <ng-template pTemplate="header">
        <div class="flex gap-3 w-full align-items-center">
            <h4>Lặp lại công việc</h4>
            <p-inputSwitch [(ngModel)]="checked" />
        </div>
    </ng-template>

    <div class="flex flex-column">
        <div class="flex gap-4 w-full">
            <div class="flex flex-column">
                <label for="hanHoanThanh" class="block mb-2 font-semibold"
                    >Ngày bắt đầu:</label
                >
                <p-calendar
                    [(ngModel)]="date2"
                    [iconDisplay]="'input'"
                    [showIcon]="true"
                    inputId="icondisplay"
                    placeholder="dd/mm/yyyy"
                />
            </div>
            <div class="flex flex-column">
                <label for="hanHoanThanh" class="block mb-2 font-semibold"
                    >Ngày kết thúc:</label
                >
                <p-calendar
                    [(ngModel)]="date2"
                    [iconDisplay]="'input'"
                    [showIcon]="true"
                    inputId="icondisplay"
                    placeholder="dd/mm/yyyy"
                />
            </div>
        </div>
        <div class="flex flex-col mt-3 mb-3">
            <div class="flex items-center gap-4">
                <label class="font-semibold">Lặp theo:</label>
                <div class="flex items-center gap-4">
                    <div class="flex items-center">
                        <p-radioButton
                            name="repeat"
                            value="ngay"
                            inputId="ngay"
                        ></p-radioButton>
                        <label for="ngay" class="ml-2">Ngày</label>
                    </div>
                    <div class="flex items-center">
                        <p-radioButton
                            name="repeat"
                            value="tuan"
                            inputId="tuan"
                            checked="true"
                        ></p-radioButton>
                        <label for="tuan" class="ml-2">Tuần</label>
                    </div>
                    <div class="flex items-center">
                        <p-radioButton
                            name="repeat"
                            value="thang"
                            inputId="thang"
                        ></p-radioButton>
                        <label for="thang" class="ml-2">Tháng</label>
                    </div>
                    <div class="flex items-center">
                        <p-radioButton
                            name="repeat"
                            value="nam"
                            inputId="nam"
                        ></p-radioButton>
                        <label for="nam" class="ml-2">Năm</label>
                    </div>
                </div>
            </div>
        </div>
        <!-- Chu kì lặp  -->
        <div class="list-option">
            <div class="flex align-items-center gap-4">
                <label>Chu kì lặp:</label>
                <p-dropdown
                    [options]=""
                    optionLabel="name"
                    placeholder="Select a City"
                />
            </div>
            <div class="dayOfWeek mt-4">
                <div class="flex flex-column">
                    <div class="flex gap-3 mb-4">
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu2"
                            ></p-checkbox>
                            <label for="thu2">Thứ 2</label>
                        </div>
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu3"
                            ></p-checkbox>
                            <label for="thu3">Thứ 3</label>
                        </div>
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu4"
                            ></p-checkbox>
                            <label for="thu4">Thứ 4</label>
                        </div>
                    </div>
                    <div class="flex gap-3 mb-4">
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu5"
                            ></p-checkbox>
                            <label for="thu5">Thứ 5</label>
                        </div>
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu6"
                            ></p-checkbox>
                            <label for="thu6">Thứ 6</label>
                        </div>
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="thu7"
                            ></p-checkbox>
                            <label for="thu7">Thứ 7</label>
                        </div>
                        <div class="dayOfWeek-item flex items-center gap-2">
                            <p-checkbox
                                [binary]="true"
                                inputId="chunhat"
                            ></p-checkbox>
                            <label for="chunhat">Chủ nhật</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="hour-loop">
            <div class="dayOfWeek-item flex align-items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Giờ lặp</label>
                <input type="time" id="time-input" class="time-input" />
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-between gap-2">
            <div class="flex gap-2 align-items-center">
                <span>
                    <i class="pi pi-cog"></i>
                </span>
                <span>Thiết lập</span>
            </div>
            <p-button label="Xác nhận"></p-button>
        </div>
    </ng-template>
</p-dialog>

<p-dialog
    header="Thêm tên công việc"
    [(visible)]="createLoopJobConfigVisible"
    [modal]="true"
    [style]="{ width: '35rem' }"
    [closable]="true"
>
    <ng-template pTemplate="header">
        <div class="flex gap-3 w-full align-items-center">
            <h4>Thiết lập lặp công việc</h4>
        </div>
    </ng-template>

    <div class="flex flex-column gap-3">
        <h5>Sử dụng dữ liệu của</h5>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
                <p-radioButton
                    name="dataSource1"
                    inputId="option1"
                ></p-radioButton>
                <label for="option1">Tùy chọn 1</label>
            </div>
        </div>
    </div>

    <div class="flex flex-column">
        <h5>Chọn thành phần lặp lại</h5>
        <div class="flex flex-column">
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Tên công việc</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Mô tả</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Công việc con</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Tệp đính kèm</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Gắn thẻ</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Mức độ nghiêm trọng</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Người thực hiện</label>
            </div>
            <div class="flex items-center gap-2">
                <p-checkbox [binary]="true" inputId="thu2"></p-checkbox>
                <label for="thu2">Người liên quan</label>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-between gap-2">
            <div class="flex gap-2 align-items-center">
                <span>
                    <i class="pi pi-cog"></i>
                </span>
                <span>Thiết lập</span>
            </div>
            <p-button label="Xác nhận"></p-button>
        </div>
    </ng-template>
</p-dialog>

<p-dialog
    header="Thêm tên công việc"
    [(visible)]="createLoopJobConfigVisible"
    [modal]="true"
    [style]="{ width: '35rem' }"
    [closable]="true"
>
    <ng-template pTemplate="header">
        <div class="flex gap-3 w-full align-items-center">
            <h4>Gắn thẻ</h4>
        </div>
    </ng-template>
    <div class="flex flex-column">
        <div class="flex flex-column">
            <span class="block mt-2 md:mt-0 p-input-icon-left">
                <i class="pi pi-search"></i>
                <input
                    pInputText
                    type="text"
                    [style]="{ width: '100%' }"
                    placeholder="Tìm theo Mã/tên vị trí"
                />
            </span>
        </div>
        <!-- Danh sách thẻ đã chọn -->
        <div class="mt-3">
            <h5 class="mb-2">Danh sách thẻ đã chọn</h5>
            <ul class="selected-tags-list">
                <li
                    *ngFor="let selectedTag of selectedTags"
                    class="flex align-items-center gap-2 mb-2"
                >
                    <i
                        [style.backgroundColor]="selectedTag.color"
                        class="color-indicator border-round"
                        style="width: 20px; height: 20px; display: inline-block"
                    ></i>
                    <span>{{ selectedTag.name }}</span>
                    <span class="ml-auto">{{
                        selectedTag.checked ? "Đã chọn" : "Chưa chọn"
                    }}</span>
                </li>
            </ul>
        </div>
        <div class="flex gap-2 flex-wrap mt-0 mb-0 mx-0">
            <div *ngFor="let selectedTag of selectedTags" class="flex gap-2">
                <p-checkbox
                    [(ngModel)]="selectedTag.checked"
                    binary="true"
                    inputId="{{ selectedTag.name }}"
                ></p-checkbox>
                <span class="tag-item flex gap-2">
                    <i
                        [style.backgroundColor]="selectedTag.color"
                        class="color-indicator"
                    ></i>
                    {{ selectedTag.name }}
                    <div class="flex gap-2">
                        <i
                            class="d-block pi pi-trash"
                            style="font-size: 12px"
                            (click)="deleteTag(i)"
                        ></i>
                    </div>
                </span>
            </div>
        </div>
        <!-- Danh sách nhập liệu -->
        <div class="flex flex-wrap m-0">
            <div
                *ngFor="let tag of tags; let i = index"
                class="flex align-items-center gap-2 mt-2"
            >
                <input
                    type="text"
                    pInputText
                    [(ngModel)]="tag.name"
                    placeholder="Tên thẻ"
                    class="input-tag"
                />
                <input
                    type="color"
                    [(ngModel)]="tag.color"
                    class="color-picker"
                />
                <button pButton (click)="saveTag(i)" label="Xong"></button>
            </div>
        </div>
        <!-- Thêm thẻ mới -->
        <div
            class="hover:surface-hover px-1 py-1 flex align-items-center gap-1 mt-2 mb-2"
            style="width: fit-content; border-radius: 5px"
        >
            <span class="border-round transition-colors">
                <i
                    class="d-block pi pi-plus-circle text-primary text-lg cursor-pointer"
                ></i>
            </span>
            <label
                class="text-primary cursor-pointer transition-colors"
                (click)="addTag()"
            >
                Thêm thẻ
            </label>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-between gap-2">
            <div class="flex gap-2 align-items-center">
                <span>
                    <i class="pi pi-cog"></i>
                </span>
                <span>Thiết lập</span>
            </div>
            <p-button label="Xác nhận"></p-button>
        </div>
    </ng-template>
</p-dialog>
